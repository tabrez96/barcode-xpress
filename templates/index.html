{% extends "base.html" %}

{% block content %}
<div class="flex flex-col items-center">
    <input
        type="text"
        id="text-input"
        name="barcode"
        placeholder="Enter barcode"
        class="border border-gray-300 p-2 rounded w-full max-w-md mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
        x-ref="textInput"
    >
    <button
        hx-post="/scan"
        hx-target="#message"
        hx-swap="innerHTML"
        hx-include='input[name="barcode"]'
        hx-disabled-elt="this"
        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
        x-on:htmx:after-request="() => {
            $nextTick(() => {
                $refs.textInput.value = '';
            });
        }"
    >
        Scan
    </button>
</div>
{% include "partials/message.html" %}
{% endblock %}

{% block scripts %}
<script>
    document.body.addEventListener('htmx:afterRequest', (event) => {
        const response = event.detail.xhr.response;
        const messageDiv = document.getElementById('message');
        try {
            const data = JSON.parse(response);
            if (data.status === 'success') {
                messageDiv.innerHTML = `<div class="text-green-500">${data.message}</div>`;
            } else {
                messageDiv.innerHTML = `<div class="text-red-500">${data.detail || 'Unknown error'}</div>`;
            }
        } catch (e) {
            console.error('Error parsing response:', e);
            messageDiv.innerHTML = '<div class="text-red-500">Error processing response</div>';
        }
    });
</script>
{% endblock %}
